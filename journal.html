<!DOCTYPE html>
<html lang="en">

<head>
  <script src="auth.js"></script>
  <meta charset="UTF-8" />
  <title>Journal & Worry Jar | Mindful Haven</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;800&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap"
    rel="stylesheet" />
  <link href="mobile-responsive.css" rel="stylesheet">
  <style>
    :root {
      /* Light Mode - Sage Wellness Palette */
      --sage-gradient: linear-gradient(135deg, #c9dcc4 0%, #d4c5e8 100%);
      --sage-dark: #5a6b56;
      --bg-primary: #f9fafb;
      --bg-secondary: #ffffff;
      --text-dark: #111827;
      --text-muted: #6b7280;
      --accent: #6366f1;
      --accent-soft: #eef2ff;
      --border-light: #e5e7eb;
      --glass-bg: rgba(255, 255, 255, 0.9);
      --glass-border: rgba(255, 255, 255, 0.7);
      --accent-pink: #f472b6;
      --kaizen-orange: #fb923c;
      --forest-green: #4ade80;
    }

    [data-theme="dark"] {
      /* Dark Mode - Restful Slate (WCAG AA Compliant) */
      --sage-gradient: linear-gradient(135deg, #1e293b 0%, #334155 100%);
      --sage-dark: #94a3b8;
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --text-dark: #f1f5f9;
      --text-muted: #94a3b8;
      --accent: #8b5cf6;
      --accent-soft: #312e81;
      --border-light: #334155;
      --glass-bg: rgba(30, 41, 59, 0.9);
      --glass-border: rgba(71, 85, 105, 0.7);
      --accent-pink: #ec4899;
      --kaizen-orange: #fb923c;
      --forest-green: #4ade80;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Plus Jakarta Sans", sans-serif;
    }

    body {
      background: var(--bg-primary);
      color: var(--text-dark);
      padding-bottom: 60px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 8%;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-light);
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
      transition: all 0.3s ease;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
      font-size: 1.1rem;
      color: var(--sage-dark);
    }

    .logo i {
      font-size: 1.3rem;
    }

    .nav-center {
      display: flex;
      gap: 28px;
      list-style: none;
    }

    .nav-center a {
      text-decoration: none;
      color: var(--text-muted);
      font-size: 0.9rem;
      font-weight: 500;
      transition: color 0.2s;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .nav-center a.active {
      color: var(--sage-dark);
      font-weight: 600;
    }

    .nav-center a:hover {
      color: var(--accent);
    }

    .nav-right {
      display: flex;
      gap: 16px;
      align-items: center;
    }

    .nav-right a {
      text-decoration: none;
      color: var(--text-muted);
      font-size: 0.9rem;
      transition: all 0.2s;
    }

    .nav-right a:hover {
      color: var(--accent);
    }

    /* Glassmorphism theme toggle */
    .theme-toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      background: var(--glass-bg);
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid var(--border-light);
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.85rem;
      backdrop-filter: blur(12px);
    }

    .theme-toggle:hover {
      background: var(--glass-border);
      transform: translateY(-1px);
    }

    .theme-toggle.active {
      background: var(--accent-soft);
      color: var(--accent);
    }

    .hero-strip {
      padding: 40px 8% 30px;
      background: var(--sage-gradient);
      transition: background 0.5s ease;
      position: relative;
      overflow: hidden;
    }

    .botanical-left,
    .botanical-right {
      position: absolute;
      opacity: 0.4;
      pointer-events: none;
      transition: opacity 0.3s;
      z-index: 0;
    }

    .botanical-left {
      left: -50px;
      top: 0;
      width: 300px;
      height: 100%;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 400"><path d="M50,50 Q80,100 50,150 T50,250 T50,350" stroke="%235a6b56" stroke-width="3" fill="none" opacity="0.3"/><ellipse cx="70" cy="80" rx="30" ry="15" fill="%2387a383" opacity="0.4" transform="rotate(-20 70 80)"/><ellipse cx="30" cy="130" rx="35" ry="18" fill="%2387a383" opacity="0.4" transform="rotate(15 30 130)"/><ellipse cx="65" cy="200" rx="28" ry="14" fill="%2387a383" opacity="0.4" transform="rotate(-25 65 200)"/></svg>') no-repeat;
      background-size: contain;
    }

    .botanical-right {
      right: -50px;
      top: 0;
      width: 300px;
      height: 100%;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 400"><path d="M150,50 Q120,100 150,150 T150,250 T150,350" stroke="%235a6b56" stroke-width="3" fill="none" opacity="0.3"/><ellipse cx="130" cy="80" rx="30" ry="15" fill="%2387a383" opacity="0.4" transform="rotate(20 130 80)"/><ellipse cx="170" cy="130" rx="35" ry="18" fill="%2387a383" opacity="0.4" transform="rotate(-15 170 130)"/><ellipse cx="135" cy="200" rx="28" ry="14" fill="%2387a383" opacity="0.4" transform="rotate(25 135 200)"/></svg>') no-repeat;
      background-size: contain;
    }

    [data-theme="dark"] .botanical-left,
    [data-theme="dark"] .botanical-right {
      opacity: 0.15;
    }

    .hero-inner {
      max-width: 1200px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }

    .mindful-buddies {
      position: absolute;
      bottom: 15px;
      right: 8%;
      width: 150px;
      height: 110px;
      z-index: 2;
      opacity: 0.85;
      pointer-events: none;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 200"><g transform="translate(80, 100)"><ellipse cx="0" cy="0" rx="35" ry="45" fill="%23ffc9b5" /><path d="M-35,-15 Q0,-45 35,-15" fill="%235a6b56" /><ellipse cx="-20" cy="-25" rx="12" ry="8" fill="%2387a383" transform="rotate(-20)" /><ellipse cx="20" cy="-25" rx="12" ry="8" fill="%2387a383" transform="rotate(20)" /><path d="M-10,5 Q-5,8 0,5 M10,5 Q15,8 20,5" stroke="%23374151" stroke-width="2" fill="none" opacity="0.6"/><path d="M-5,20 Q5,28 15,20" stroke="%23374151" stroke-width="2" fill="none" /></g><g transform="translate(200, 110)"><ellipse cx="0" cy="0" rx="38" ry="48" fill="%23ffc9b5" /><path d="M-38,-15 Q0,-48 38,-15" fill="%235a6b56" /><ellipse cx="-22" cy="-28" rx="14" ry="9" fill="%2387a383" transform="rotate(-15)" /><ellipse cx="22" cy="-28" rx="14" ry="9" fill="%2387a383" transform="rotate(15)" /><path d="M-12,5 Q-6,8 0,5 M12,5 Q18,8 24,5" stroke="%23374151" stroke-width="2" fill="none" opacity="0.6"/><path d="M-6,22 Q6,30 18,22" stroke="%23374151" stroke-width="2" fill="none" /></g><circle cx="40" cy="40" r="10" fill="%23d4c5e8" opacity="0.5" /><circle cx="260" cy="160" r="8" fill="%23d4c5e8" opacity="0.5" /></svg>') no-repeat center/contain;
      animation: float 6s ease-in-out infinite;
    }

    @keyframes float {

      0%,
      100% {
        transform: translateY(0);
      }

      50% {
        transform: translateY(-10px);
      }
    }

    @keyframes fadeInBounce {
      0% {
        opacity: 0;
        transform: translateY(20px) scale(0.9);
      }

      60% {
        opacity: 1;
        transform: translateY(-5px) scale(1.05);
      }

      100% {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .affirmation-bubble {
      position: absolute;
      bottom: 145px;
      right: 8%;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.9) 100%);
      backdrop-filter: blur(16px);
      border: 2px solid rgba(255, 255, 255, 0.8);
      border-radius: 24px;
      padding: 16px 22px;
      max-width: 260px;
      z-index: 3;
      box-shadow: 0 12px 32px rgba(99, 102, 241, 0.2), 0 4px 12px rgba(0, 0, 0, 0.1);
      animation: fadeInBounce 1.2s ease-out 0.8s both;
    }

    [data-theme="dark"] .affirmation-bubble {
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.98) 0%, rgba(30, 41, 59, 0.95) 100%);
      border-color: rgba(255, 255, 255, 0.1);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.4), 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .affirmation-bubble p {
      margin: 0;
      font-size: 0.95rem;
      color: var(--text-dark);
      font-weight: 600;
      line-height: 1.5;
      text-align: center;
    }

    .hero-title {
      font-family: "Playfair Display", serif;
      font-size: 2.1rem;
      margin-bottom: 6px;
      color: var(--text-dark);
    }

    .hero-sub {
      font-size: 0.95rem;
      color: var(--text-muted);
    }

    /* Two column layout */
    .main {
      padding: 24px 8%;
    }

    .main-inner {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 380px;
      gap: 24px;
    }

    /* Stats grid above main content */
    .stats-section {
      grid-column: 1 / -1;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 16px;
    }

    .stat-card {
      background: var(--bg-secondary);
      border-radius: 16px;
      padding: 20px;
      text-align: center;
      border: 1px solid var(--border-light);
      transition: all 0.3s;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.1);
    }

    .stat-number {
      font-size: 2rem;
      font-weight: 800;
      color: var(--accent);
      line-height: 1;
    }

    .stat-label {
      font-size: 0.8rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-top: 8px;
    }

    /* Left column - Journal */
    .journal-column {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .card {
      background: var(--bg-secondary);
      border-radius: 20px;
      padding: 24px;
      border: 1px solid var(--border-light);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .card:hover {
      box-shadow: 0 16px 48px rgba(0, 0, 0, 0.15);
    }

    .card h3 {
      font-size: 1.15rem;
      margin-bottom: 8px;
      color: var(--text-dark);
    }

    .card .sub {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-bottom: 16px;
    }

    /* Enhanced prompt box with glow */
    .prompt-box {
      background: var(--accent-soft);
      border-left: 4px solid var(--accent);
      padding: 16px 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      font-size: 0.95rem;
      color: var(--accent);
      position: relative;
      overflow: hidden;
      transition: all 0.3s;
      cursor: pointer;
    }

    .prompt-box:hover {
      transform: translateX(4px);
    }

    .prompt-box::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 4px;
      background: linear-gradient(to bottom, transparent, var(--accent), transparent);
      animation: glow 3s ease-in-out infinite;
    }

    @keyframes glow {

      0%,
      100% {
        opacity: 0.3;
      }

      50% {
        opacity: 1;
      }
    }

    .input-group {
      margin: 20px 0;
    }

    .input-group label {
      display: block;
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--text-dark);
    }

    .input-group textarea {
      width: 100%;
      padding: 16px;
      border-radius: 12px;
      border: 1px solid var(--border-light);
      font-size: 0.95rem;
      min-height: 220px;
      resize: vertical;
      font-family: inherit;
      background: var(--bg-primary);
      color: var(--text-dark);
      transition: all 0.3s ease;
      line-height: 1.7;
    }

    .input-group textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15);
      transform: translateY(-2px);
    }

    /* Mood selector */
    .mood-selector {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .mood-btn {
      padding: 12px;
      border-radius: 12px;
      border: 2px solid var(--border-light);
      background: var(--bg-primary);
      cursor: pointer;
      transition: all 0.3s;
      font-size: 1.4rem;
      flex: 1;
      min-width: 80px;
      text-align: center;
    }

    .mood-btn:hover {
      border-color: var(--accent);
      transform: scale(1.05);
    }

    .mood-btn.selected {
      border-color: var(--accent);
      background: var(--accent-soft);
      transform: scale(1.1);
    }

    /* Action buttons */
    .btn-row {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .btn-primary {
      flex: 1;
      padding: 14px;
      border-radius: 999px;
      background: var(--text-dark);
      color: #fff;
      border: none;
      font-weight: 700;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .btn-primary:hover {
      background: #000;
      transform: translateY(-2px);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
    }

    .btn-burn {
      flex: 1;
      padding: 14px;
      border-radius: 999px;
      background: linear-gradient(135deg, #ef4444, #f97316);
      color: #fff;
      border: none;
      font-weight: 700;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.3s;
    }

    .btn-burn:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 32px rgba(239, 68, 68, 0.4);
    }

    /* Journal entries */
    .journal-entry {
      padding: 20px;
      background: var(--bg-primary);
      border-radius: 16px;
      margin-bottom: 16px;
      border-left: 5px solid var(--accent);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .journal-entry::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 4px;
      background: linear-gradient(45deg, var(--accent), var(--accent-soft));
    }

    .journal-entry:hover {
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
      transform: translateX(8px);
    }

    .entry-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .entry-date {
      font-size: 0.85rem;
      color: var(--text-muted);
      font-weight: 500;
    }

    .entry-mood {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.85rem;
    }

    .mood-badge {
      background: var(--accent-soft);
      color: var(--accent);
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .entry-prompt {
      font-size: 0.85rem;
      color: var(--accent);
      margin-bottom: 12px;
      font-style: italic;
      font-weight: 500;
    }

    .entry-text {
      font-size: 0.95rem;
      color: var(--text-dark);
      line-height: 1.7;
    }

    .btn-secondary {
      padding: 8px 16px;
      border-radius: 999px;
      background: var(--glass-bg);
      color: var(--text-muted);
      border: 1px solid var(--border-light);
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-secondary:hover {
      background: var(--accent-soft);
      color: var(--accent);
      border-color: var(--accent);
    }

    /* Right column - Worry Jar */
    .worry-column {
      position: sticky;
      top: 100px;
      height: fit-content;
    }

    .jar-card {
      background: var(--bg-secondary);
      border-radius: 20px;
      padding: 30px;
      border: 1px solid var(--border-light);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
      text-align: center;
    }

    .jar-card h3 {
      font-size: 1.4rem;
      margin-bottom: 8px;
    }

    .jar-card .sub {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-bottom: 24px;
    }

    /* Worry Jar Design */
    .jar-container {
      width: 140px;
      height: 180px;
      margin: 20px auto;
      position: relative;
      cursor: pointer;
      transition: transform 0.3s;
    }

    .jar-container:hover {
      transform: scale(1.05);
    }

    .jar-lid {
      width: 100px;
      height: 20px;
      background: var(--text-muted);
      border-radius: 5px;
      margin: 0 auto;
      border: 1px solid var(--border-light);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .jar-body {
      width: 120px;
      height: 150px;
      margin: -5px auto 0 auto;
      border: 2px solid var(--border-light);
      border-radius: 20px;
      background: var(--glass-bg);
      position: relative;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.05), inset 0 0 20px rgba(0, 0, 0, 0.03);
      overflow: hidden;
      backdrop-filter: blur(10px);
    }

    .jar-glass {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 10px;
      height: 60px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 10px;
    }

    /* Fireflies (worry indicators) */
    .firefly {
      position: absolute;
      width: 6px;
      height: 6px;
      background: var(--kaizen-orange);
      border-radius: 50%;
      box-shadow: 0 0 10px var(--kaizen-orange), 0 0 20px var(--kaizen-orange);
      animation: fly 4s infinite alternate ease-in-out;
      opacity: 0.8;
    }

    @keyframes fly {
      0% {
        transform: translate(0, 0);
      }

      100% {
        transform: translate(var(--mx), var(--my));
      }
    }

    /* Worry input */
    .worry-input-row {
      display: flex;
      gap: 8px;
      margin-top: 24px;
    }

    .worry-input {
      flex: 1;
      background: var(--bg-primary);
      border: 1px solid var(--border-light);
      color: var(--text-dark);
      padding: 12px 16px;
      border-radius: 12px;
      font-size: 0.9rem;
      outline: none;
      transition: all 0.3s;
      font-family: inherit;
    }

    .worry-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    .btn-add-worry {
      background: var(--accent);
      color: white;
      border: none;
      padding: 12px 16px;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 1rem;
    }

    .btn-add-worry:hover {
      background: var(--accent);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3);
    }

    /* Modal for worry jar contents */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      z-index: 200;
      display: none;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(12px);
    }

    .modal-card {
      background: var(--bg-secondary);
      color: var(--text-dark);
      border: 1px solid var(--border-light);
      width: 90%;
      max-width: 600px;
      max-height: 80vh;
      border-radius: 20px;
      padding: 0;
      position: relative;
      box-shadow: 0 50px 100px -20px rgba(0, 0, 0, 0.5);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      padding: 24px 30px;
      border-bottom: 1px solid var(--border-light);
      align-items: center;
    }

    .modal-title {
      font-weight: 700;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .close-modal {
      font-size: 1.2rem;
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.2s;
    }

    .close-modal:hover {
      color: var(--text-dark);
      transform: scale(1.2);
    }

    .modal-content {
      padding: 30px;
      overflow-y: auto;
      flex: 1;
    }

    /* Worry items in modal */
    .worry-item {
      background: var(--bg-primary);
      padding: 16px 20px;
      border-radius: 12px;
      margin-bottom: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid var(--border-light);
      transition: all 0.3s;
    }

    .worry-item:hover {
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
      transform: translateX(4px);
    }

    .worry-text {
      flex: 1;
      font-size: 0.95rem;
      color: var(--text-dark);
    }

    .worry-actions {
      display: flex;
      gap: 12px;
    }

    .worry-actions i {
      cursor: pointer;
      opacity: 0.6;
      transition: all 0.2s;
      font-size: 1rem;
    }

    .worry-actions i:hover {
      opacity: 1;
      transform: scale(1.2);
    }

    .fa-trash:hover {
      color: #ef4444;
    }

    .fa-book-open:hover {
      color: var(--accent);
    }

    /* Empty state */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-muted);
    }

    .empty-state i {
      font-size: 3rem;
      margin-bottom: 16px;
      opacity: 0.3;
    }

    .empty-state p {
      font-size: 1rem;
      line-height: 1.6;
    }

    @media(max-width:900px) {
      .nav-center {
        display: none;
      }

      .main-inner {
        grid-template-columns: 1fr;
        gap: 20px;
      }

      .worry-column {
        position: static;
        margin-top: 20px;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .mood-selector {
        justify-content: center;
      }

      .mood-btn {
        flex: 1 1 70px;
      }
    }
  </style>
</head>

<body>
  <nav>
    <div class="logo"><i class="fas fa-brain"></i> Mindful Haven</div>
    <ul class="nav-center">
      <li><a href="healing-journey.html">Journey</a></li>
      <li><a href="mood-tracker.html">Mood</a></li>
      <li><a href="journal.html" class="active">Journal</a></li>
      <li><a href="crisis.html">Crisis</a></li>
    </ul>
    <div class="nav-right">
      <div class="theme-toggle" id="themeToggle" data-theme="light">
        <i class="fas fa-sun"></i>
        <span>Light</span>
      </div>
      <a href="counselors.html"><i class="fas fa-user-md"></i> Support</a>
    </div>
  </nav>

  <section class="hero-strip">
    <div class="botanical-left"></div>
    <div class="botanical-right"></div>
    <div class="mindful-buddies"></div>
    <div class="hero-inner">
      <h1 class="hero-title">Journal & Worry Jar</h1>
      <p class="hero-sub">A safe space to reflect, process emotions, and store worries for later</p>
    </div>
  </section>

  <main class="main">
    <div class="main-inner">
      <!-- Stats Dashboard -->
      <div class="stats-section">
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-number" id="totalEntries">0</div>
            <div class="stat-label">Total Entries</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="streakDays">0</div>
            <div class="stat-label">Writing Streak</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="avgMood">üòê</div>
            <div class="stat-label">Avg Mood</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="wordsToday">0</div>
            <div class="stat-label">Words Today</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="worryCount">0</div>
            <div class="stat-label">Worries Stored</div>
          </div>
        </div>
      </div>

      <!-- Left Column - Journal -->
      <div class="journal-column">
        <div class="card">
          <h3>Today's Reflection</h3>
          <p class="sub">How are you feeling? Write freely or use the personalized prompt below</p>

          <!-- Mood selector -->
          <div class="mood-selector" id="journalMoodScale">
            <div class="mood-btn" data-mood="1" title="Very bad">üò¢</div>
            <div class="mood-btn" data-mood="2" title="Bad">üòü</div>
            <div class="mood-btn" data-mood="3" title="Okay">üòê</div>
            <div class="mood-btn" data-mood="4" title="Good">üôÇ</div>
            <div class="mood-btn" data-mood="5" title="Great">üòä</div>
          </div>

          <div class="prompt-box" id="promptBox" onclick="newPrompt()">
            <i class="fas fa-lightbulb"></i> <span id="todayPrompt">Click for a new prompt...</span>
          </div>

          <div class="input-group">
            <label>Your journal entry</label>
            <textarea id="journalText"
              placeholder="Let your thoughts flow freely here... What's on your mind today?"></textarea>
          </div>

          <div class="btn-row">
            <button class="btn-burn" id="burnEntry">
              <i class="fas fa-fire"></i> Burn Entry
            </button>
            <button class="btn-primary" id="saveEntry">
              <i class="fas fa-save"></i> Save Reflection
            </button>
          </div>
        </div>

        <div class="card">
          <h3>Your Reflections</h3>
          <p class="sub">Recent entries with mood tracking (last 10)</p>
          <div id="entriesHistory"></div>
        </div>
      </div>

      <!-- Right Column - Worry Jar -->
      <div class="worry-column">
        <div class="jar-card">
          <h3>ü´ô Worry Jar</h3>
          <p class="sub">Store worries for later when you're ready to process them</p>

          <div id="theJar" class="jar-container" onclick="openJar()">
            <div class="jar-lid"></div>
            <div class="jar-body">
              <div class="jar-glass"></div>
              <div id="firefly-zone" style="width:100%;height:100%;position:relative;"></div>
            </div>
          </div>

          <div class="worry-input-row">
            <input type="text" id="worryInput" class="worry-input" placeholder="Type a worry...">
            <button class="btn-add-worry" onclick="addWorry()">
              <i class="fas fa-plus"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Worry Jar Modal -->
  <div class="modal-overlay" id="worryModal">
    <div class="modal-card">
      <div class="modal-header">
        <div class="modal-title"><i class="fas fa-book-open"></i> Process Your Worries</div>
        <i class="fas fa-times close-modal" onclick="closeWorryModal()"></i>
      </div>
      <div class="modal-content" id="worryListArea"></div>
    </div>
  </div>

  <!-- Canvas Confetti Library -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <script>
    // ===== THEME MANAGEMENT =====
    function initTheme() {
      const savedTheme = localStorage.getItem('mh_theme') || 'light';
      document.documentElement.setAttribute('data-theme', savedTheme);

      const toggle = document.getElementById('themeToggle');
      const icon = toggle.querySelector('i');
      const text = toggle.querySelector('span');

      if (savedTheme === 'dark') {
        toggle.classList.add('active');
        icon.className = 'fas fa-moon';
        text.textContent = 'Dark';
      }
    }

    document.getElementById('themeToggle').addEventListener('click', function () {
      const html = document.documentElement;
      const currentTheme = html.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

      html.setAttribute('data-theme', newTheme);
      localStorage.setItem('mh_theme', newTheme);

      const icon = this.querySelector('i');
      const text = this.querySelector('span');

      if (newTheme === 'dark') {
        this.classList.add('active');
        icon.className = 'fas fa-moon';
        text.textContent = 'Dark';
      } else {
        this.classList.remove('active');
        icon.className = 'fas fa-sun';
        text.textContent = 'Light';
      }
    });

    // ===== UTILITY FUNCTIONS =====
    function getUserKey(k) {
      // Check both storages for the current user
      const user = localStorage.getItem('mh_user') || sessionStorage.getItem('mh_user');
      return user ? `${user}_${k}` : k;
    }

    function safeRead(k) {
      try {
        const key = getUserKey(k);
        return localStorage.getItem(key) ? JSON.parse(localStorage.getItem(key)) : null;
      } catch {
        return null;
      }
    }

    function safeReadArray(k) {
      try {
        const key = getUserKey(k);
        return localStorage.getItem(key) ? JSON.parse(localStorage.getItem(key)) : [];
      } catch {
        return [];
      }
    }

    function saveData(k, v) {
      const key = getUserKey(k);
      localStorage.setItem(key, JSON.stringify(v));
    }

    // ===== JOURNAL FUNCTIONALITY =====
    let selectedMood = null;
    const elements = {
      journalMoodScale: document.getElementById("journalMoodScale"),
      journalText: document.getElementById("journalText"),
      saveEntryBtn: document.getElementById("saveEntry"),
      burnEntryBtn: document.getElementById("burnEntry"),
      entriesHistory: document.getElementById("entriesHistory"),
      todayPrompt: document.getElementById("todayPrompt"),
      totalEntries: document.getElementById("totalEntries"),
      streakDays: document.getElementById("streakDays"),
      avgMood: document.getElementById("avgMood"),
      wordsToday: document.getElementById("wordsToday"),
      worryCount: document.getElementById("worryCount")
    };

    // Mood selector functionality
    elements.journalMoodScale.addEventListener("click", (e) => {
      if (e.target.classList.contains("mood-btn")) {
        document.querySelectorAll(".mood-btn").forEach(b => b.classList.remove("selected"));
        e.target.classList.add("selected");
        selectedMood = parseInt(e.target.dataset.mood, 10);
      }
    });

    // Personalized prompts based on stress level
    const stress = safeRead("mh_stress_assessment") || {};
    const level = stress.level || "low";
    const prompts = {
      low: [
        "What are three things you're grateful for today?",
        "What's one small win you had this week?",
        "What energizes you and brings you joy?",
        "What's something you're looking forward to?",
        "How can you build on what's already working well?",
        "Write about a place where you feel safe.",
        "Who is someone you appreciate and why?"
      ],
      moderate: [
        "What feels hardest right now, and why?",
        "What's one thing you can control today?",
        "What support do you need that you haven't asked for?",
        "What patterns do you notice in your stress?",
        "If you could let go of one worry, what would it be?",
        "What is a challenge you overcame recently?",
        "How are you feeling right now, really?"
      ],
      high: [
        "What do you need to feel safe right now?",
        "Name one thing that helped you get through today.",
        "What would you tell a friend feeling like you do?",
        "What's the smallest step you could take right now?",
        "Who can you reach out to for support?",
        "What is one goal you want to focus on tomorrow?",
        "What made you smile today, even if just a little?"
      ]
    };

    let currentPrompt = "";

    function newPrompt() {
      const promptList = prompts[level];
      currentPrompt = promptList[Math.floor(Math.random() * promptList.length)];
      elements.todayPrompt.textContent = currentPrompt;
    }

    // Save entry
    elements.saveEntryBtn.addEventListener("click", () => {
      const text = elements.journalText.value.trim();
      if (!text) {
        alert("Please share your thoughts! üí≠");
        return;
      }
      if (!selectedMood) {
        alert("Please select your mood for today! üòä");
        return;
      }

      const entries = safeReadArray("mh_journal");
      const wordCount = text.split(/\s+/).filter(w => w.length > 0).length;
      const entry = {
        date: new Date().toISOString(),
        prompt: currentPrompt,
        text: text,
        mood: selectedMood,
        wordCount: wordCount,
        stressLevel: level
      };

      entries.push(entry);
      saveData("mh_journal", entries);

      alert("‚ú® Reflection saved! Your words matter.");
      elements.journalText.value = "";
      selectedMood = null;
      document.querySelectorAll(".mood-btn").forEach(b => b.classList.remove("selected"));
      updateStats();
      renderEntries();
    });

    // Burn entry with confetti
    elements.burnEntryBtn.addEventListener("click", () => {
      const text = elements.journalText.value.trim();
      if (!text) {
        alert("Nothing to burn! Write something first.");
        return;
      }

      if (confirm('Burn this entry? This deletes it permanently and can help you let go.')) {
        // Confetti effect (only if loaded)
        if (typeof confetti === 'function') {
          const duration = 2 * 1000;
          const end = Date.now() + duration;

          (function frame() {
            confetti({
              particleCount: 5,
              angle: 60,
              spread: 55,
              origin: { x: 0 },
              colors: ['#ef4444', '#f97316', '#fb923c']
            });
            confetti({
              particleCount: 5,
              angle: 120,
              spread: 55,
              origin: { x: 1 },
              colors: ['#ef4444', '#f97316', '#fb923c']
            });
            if (Date.now() < end) requestAnimationFrame(frame);
          })();
        }

        const area = elements.journalText;
        area.style.transition = '0.5s';
        area.style.opacity = 0;
        setTimeout(() => {
          area.value = '';
          area.style.opacity = 1;
          selectedMood = null;
          document.querySelectorAll(".mood-btn").forEach(b => b.classList.remove("selected"));
        }, 500);
      }
    });

    // Enhanced stats calculation
    function updateStats() {
      const entries = safeReadArray("mh_journal");
      const total = entries.length;
      elements.totalEntries.textContent = total || 0;

      // Streak calculation
      const today = new Date().toISOString().split('T')[0];
      const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
      let streak = 0;
      for (let i = 0; i < entries.length; i++) {
        const entryDate = new Date(entries[i].date).toISOString().split('T')[0];
        if (entryDate === today || entryDate === yesterday) {
          streak = Math.max(streak, 1);
        }
      }
      elements.streakDays.textContent = streak || 0;

      // Average mood
      if (entries.length > 0) {
        const avgMood = Math.round(entries.reduce((sum, e) => sum + e.mood, 0) / entries.length);
        const moodEmojis = ["", "üò¢", "üòü", "üòê", "üôÇ", "üòä"];
        elements.avgMood.textContent = moodEmojis[avgMood] || "üòê";
      }

      // Words today
      const todayEntries = entries.filter(e =>
        new Date(e.date).toISOString().split('T')[0] === new Date().toISOString().split('T')[0]
      );
      const todayWords = todayEntries.reduce((sum, e) => sum + e.wordCount, 0);
      elements.wordsToday.textContent = todayWords || 0;

      // Worry count
      const worries = safeReadArray("mh_worries");
      elements.worryCount.textContent = worries.length;
    }

    // Render entries
    function renderEntries() {
      const entries = safeReadArray("mh_journal");
      const recent = entries.slice(-10).reverse();

      if (recent.length === 0) {
        elements.entriesHistory.innerHTML = "<div class='empty-state'><i class='fas fa-book-open'></i><p>No entries yet.<br>Your first reflection will appear here! ‚ú®</p></div>";
        return;
      }

      elements.entriesHistory.innerHTML = "";
      const moodEmojis = ["", "üò¢", "üòü", "üòê", "üôÇ", "üòä"];

      recent.forEach((e, idx) => {
        const div = document.createElement("div");
        div.className = "journal-entry";
        const date = new Date(e.date);
        div.innerHTML = `
          <div class="entry-header">
            <span class="entry-date">${date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}</span>
            <div style="display:flex;gap:8px;">
              <span class="entry-mood">
                <span class="mood-badge">${moodEmojis[e.mood] || 'üòê'}</span>
                <span style="font-size:0.75rem;color:var(--text-muted);">${e.wordCount} words</span>
              </span>
              <button class="btn-secondary" onclick="deleteEntry(${entries.length - 1 - idx})">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
          <div class="entry-prompt">"${e.prompt}"</div>
          <div class="entry-text">${e.text}</div>
        `;
        elements.entriesHistory.appendChild(div);
      });
    }

    window.deleteEntry = function (idx) {
      if (!confirm("Delete this reflection? Your words are safe but this can't be undone.")) return;
      const entries = safeReadArray("mh_journal");
      entries.splice(idx, 1);
      saveData("mh_journal", entries);
      updateStats();
      renderEntries();
    };

    // ===== WORRY JAR FUNCTIONALITY =====
    let worries = safeReadArray("mh_worries");

    function renderFireflies() {
      const zone = document.getElementById("firefly-zone");
      zone.innerHTML = "";

      // Limit fireflies to prevent overcrowding
      const visibleWorries = worries.slice(0, 15);

      visibleWorries.forEach(w => {
        const f = document.createElement("div");
        f.className = "firefly";
        const x = Math.random() * 80 + 10;
        const y = Math.random() * 80 + 10;
        f.style.left = x + "%";
        f.style.top = y + "%";
        f.style.setProperty("--mx", (Math.random() * 40 - 20) + "px");
        f.style.setProperty("--my", (Math.random() * 40 - 20) + "px");
        f.style.animationDelay = Math.random() + "s";
        zone.appendChild(f);
      });
    }

    function addWorry() {
      const input = document.getElementById("worryInput");
      const txt = input.value.trim();
      if (!txt) {
        alert("Please write down your worry first");
        return;
      }

      worries.push({
        text: txt,
        date: Date.now()
      });
      saveData("mh_worries", worries);
      input.value = "";
      renderFireflies();
      updateStats();

      // Show quick feedback
      input.style.borderColor = "var(--forest-green)";
      setTimeout(() => {
        input.style.borderColor = "";
      }, 1000);
    }

    // Allow Enter key to add worry
    document.getElementById("worryInput").addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        addWorry();
      }
    });

    function openJar() {
      document.getElementById("worryModal").style.display = "flex";
      renderWorryList();
    }

    function closeWorryModal() {
      document.getElementById("worryModal").style.display = "none";
    }

    function renderWorryList() {
      const list = document.getElementById("worryListArea");
      if (worries.length === 0) {
        list.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-moon"></i>
            <p>The jar is empty.<br>Your mind is clear. üåô</p>
          </div>
        `;
        return;
      }

      list.innerHTML = worries.map((w, i) => `
        <div class="worry-item">
          <span class="worry-text">${w.text}</span>
          <div class="worry-actions">
            <i class="fas fa-book-open" onclick="journalWorry(${i})" title="Journal about this"></i>
            <i class="fas fa-trash" onclick="deleteWorry(${i})" title="Release / Delete"></i>
          </div>
        </div>
      `).join('');
    }

    window.deleteWorry = function (index) {
      if (confirm('Release this worry into the universe?')) {
        worries.splice(index, 1);
        saveData("mh_worries", worries);
        renderWorryList();
        renderFireflies();
        updateStats();
      }
    };

    window.journalWorry = function (index) {
      const w = worries[index];
      elements.journalText.value = `Reflection on worry: "${w.text}"\n\n`;
      elements.journalText.focus();
      closeWorryModal();
      worries.splice(index, 1);
      saveData("mh_worries", worries);
      renderFireflies();
      updateStats();
    };

    // ===== INITIALIZATION =====
    initTheme();
    newPrompt();
    updateStats();
    renderEntries();
    renderFireflies();
  </script>
</body>

</html>